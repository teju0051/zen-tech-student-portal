<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zentech LMS Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden-section { display: none; }
    .sidebar::-webkit-scrollbar { width: 6px; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 6px; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex font-sans">

<!-- Professional LMS Sidebar - Clean Teal/Blue Theme -->
<aside class="sidebar w-64 bg-gradient-to-b from-white to-gray-50 border-r border-gray-200 flex flex-col shadow-lg">

  <!-- Logo -->
  <div class="p-6 flex items-center justify-center border-b border-gray-200">
    <img src="https://teju0051.github.io/Assets/zentehc-remove-bg.png" 
         alt="Zentech Logo" class="h-14 w-auto">
         
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto px-3 py-6 space-y-2">
    <a href="#" data-section="subject" class="nav-link active flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 bg-teal-50 hover:bg-teal-100 text-teal-700 transition duration-200">
      📘 Subjects
    </a>
    <a href="#" data-section="notice" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
      📢 Notices
    </a>
    <a href="#" data-section="staff" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
      👨‍🏫 Staff Assigned
    </a>
    <a href="#" data-section="manual" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
      📖 User Manual
    </a>
    <a href="#" data-section="logins" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
      🔑 Login Credentials
    </a>
    <a href="#" data-section="suspension" class="nav-link flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-semibold text-gray-800 hover:bg-red-50 hover:text-red-600 transition duration-200">
      ⛔ Account Suspension
    </a>
  </nav>
 Version: 9.11.00
  <!-- Footer -->
  <div class="px-4 py-4 border-t border-gray-200 flex items-center justify-between bg-gray-100">
   
    <span class="text-sm font-semibold text-gray-700">Admin</span>
    <button onclick="window.location.href='https://zen-tech-student-portal.vercel.app/';" 
            class="px-4 py-2 bg-teal-600 text-white rounded-md text-xs font-semibold hover:bg-teal-700 transition duration-200">
      🚪 Logout
    </button>
  </div>
  
</aside>



  <!-- Main Content -->
  <main class="flex-1 p-8">
    
<section id="section-subject" class=" p-4">
   <div class="border-2 border-red-700 bg-red-100 rounded-lg p-4 mb-4">
  <em class="text-red-900 text-sm">
    Here you can also add more subjects for demo. We have 1 on the bottom; after clicking on it, you will be able to upload the notes.
  </em>
</div>
  <!-- Dashboard -->
  <h2 class="text-xl md:text-2xl font-bold mb-2">Subjects Overview (Upload_Section_Admin)</h2><br>
 

<hr><br>

<div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div class="flex items-center gap-2 mb-2">
      <i class="fas fa-code text-green-600 text-lg"></i>
      <button onclick="showModule('python')" class="text-gray-900 font-semibold text-sm hover:text-green-600 transition">
        Python
      </button>
    </div>
</div>


<!-- Python Subject SECTION - White Themed -->
<section id="pythonSection" class="hidden bg-white p-6 rounded-lg border border-gray-200 shadow-sm">

  <!-- Back Button -->
  <button onclick="goBack()" 
          class="mb-4 inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition">
    <i class="fas fa-arrow-left mr-2"></i> Back
  </button>

  <!-- Header -->
  <div class="flex items-center mb-4 text-xl font-bold text-gray-900">
    📘 Python
  </div>

  <!-- Notes Section -->
  <h2 class="text-lg font-semibold flex justify-between items-center mb-3 text-gray-800">
    📚 Notes
    <div>
      <button onclick="document.getElementById('pythonFileInput').click()" 
              class="px-3 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition">
        Upload PDF
      </button>
      <input type="file" id="pythonFileInput" accept="application/pdf" class="hidden" />
    </div>
  </h2>

  <!-- Notes List -->
  <ul id="pythonNotesList" class="space-y-2 text-gray-700 text-sm"></ul>
</section>


  <script>
    function showModule(module) {
      if(module === 'python') {
        document.getElementById('dashboard').classList.add('hidden');
        document.getElementById('pythonSection').classList.remove('hidden');
      }
    }

    function goBack() {
      document.getElementById('pythonSection').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
    }
  </script>
</section>


<section id="section-notice" class="hidden-section my-8 w-full">

  <!-- Marquee Input Panel -->
  <div class="bg-white border border-gray-200 rounded-lg p-6 space-y-4 w-full">
    <h3 class="text-lg font-semibold text-gray-800 flex items-center">
       Add Announcement
    </h3>

    <!-- Textarea -->
    <textarea
      id="marqueeInput"
      rows="3"
      placeholder="Type your important alert here..."
      class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-violet-400 text-gray-900 placeholder-gray-400 resize-none"
    ></textarea>

    <!-- Checkbox -->
    <label class="flex items-center space-x-2">
      <input
        type="checkbox"
        id="marqueeActive"
        checked
        class="w-4 h-4 text-violet-600 border-gray-300 rounded focus:ring-violet-500"
      >
      <span class="text-sm text-gray-700">Mark as active (will not be updated if the box is not checked!)</span>
    </label>

    <!-- Submit Button -->
    <button
      id="submitMarquee"
      class="bg-violet-600 hover:bg-violet-700 text-white font-medium px-5 py-2 rounded transition duration-150"
    >
      ➕ Add Announcement
    </button>
  </div>

  <!-- Active Notices List -->
  <div class="mt-6 bg-white border border-gray-200 rounded-lg p-6 space-y-3 w-full">
    <h4 class="text-md font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-2">
      Active Announcements
    </h4>
    <ul id="marqueeList" class="space-y-2 text-gray-700">
     
    </ul>
  </div>

  <script type="module">
    const marqueeInput = document.getElementById("marqueeInput");
    const marqueeActive = document.getElementById("marqueeActive");
    const submitBtn = document.getElementById("submitMarquee");
    const marqueeList = document.getElementById("marqueeList");

    async function loadActiveNotices() {
      const { data, error } = await supabaseClient
        .from("marquee_alerts")
        .select("*")
        .eq("active", true)
        .order("id", { ascending: false });

      if (!error) {
        marqueeList.innerHTML = data.map(item => `<li class="border-b border-gray-100 pb-1">${item.message}</li>`).join("");
      }
    }

    submitBtn.addEventListener("click", async () => {
      const message = marqueeInput.value.trim();
      const isActive = marqueeActive.checked;

      if (!message) {
        alert("Please enter a message.");
        return;
      }

      // Optional: Set all existing to inactive
      await supabaseClient.from("marquee_alerts").update({ active: false }).eq("active", true);

      // Insert new alert
      const { error } = await supabaseClient.from("marquee_alerts").insert([
        { message, active: isActive }
      ]);

      if (error) {
        alert("Failed to save marquee message.");
        console.error("Insert error:", error.message);
      } else {
        alert("Announcement has been added successfully!");
        marqueeInput.value = "";
        loadActiveNotices();
      }
    });

    // Load notices on page load
    loadActiveNotices();
  </script>
</section>




    <section id="section-leaderboard" class="hidden-section">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">🏆 Leaderboard</h2>
      
 <form id="leaderboardForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
  <input id="studentName" type="text" required placeholder="Student Name & Surname /Full Name"
    class="px-4 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 dark:text-white">

  <input id="studentInitial" type="text" required maxlength="1" placeholder="Student Name's First Letter here!"
    class="px-4 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 dark:text-white">

  <select id="studentRank" required
    class="px-4 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 dark:text-white">
    <option value="">Rank</option>
    <option value="1">1st Place</option>
    <option value="2">2nd Place</option>
    <option value="3">3rd Place</option>
  </select>

  <select id="seasonNumber" required
    class="px-4 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 dark:text-white">
    <option value="">Season / Sem</option>
   
     <option value="3">Season 3</option>
      <option value="2">Season 4</option>
  </select>

  <button type="submit" class="md:col-span-4 bg-violet-600 hover:bg-violet-700 text-white font-semibold px-6 py-2 rounded transition mt-2">
    ➕ Add Student to Leaderboard
  </button>
</form>

    </section>

  <section id="section-staff" class="hidden-section">

  <!-- Note Box -->
  <div class="bg-gray-50 text-gray-700 text-center text-sm px-6 py-4 rounded-lg border border-gray-200 shadow-sm">
    ⚠️ <strong>Note:</strong> This table shows the school/college faculty who will be operating the software. 
    Both teaching and non-teaching staff are listed here (not visible to students).
  </div>

  <br><br>

  <!-- Staff Table -->
  <div class="overflow-x-auto mb-8">
    <table class="min-w-full bg-white rounded-lg shadow-md border border-gray-200">
      <thead class="bg-gray-100 text-gray-800 font-semibold">
        <tr>
          <th class="py-3 px-6 text-left">Name</th>
          <th class="py-3 px-6 text-left">Designation</th>
        </tr>
      </thead>
      <tbody class="text-gray-700">
        <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
          <td class="py-3 px-6">Prajakta Mane</td>
          <td class="py-3 px-6">Operation Head</td>
        </tr>
        <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
          <td class="py-3 px-6">Abdullah Khan</td>
          <td class="py-3 px-6">Manager</td>
        </tr>
        <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
          <td class="py-3 px-6">Ashwini Patil</td>
          <td class="py-3 px-6">Sr. Web Developer</td>
        </tr>
        <tr class="hover:bg-gray-50 transition">
          <td class="py-3 px-6">Ashok Tendulkar</td>
          <td class="py-3 px-6">Jr. UI/UX Developer</td>
        </tr>
      </tbody>
    </table>
  </div>

</section>


    <section id="section-manual" class="hidden-section">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">User Manual</h2><br><br>
     <div class="bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-300 text-center text-sm px-6 py-4 rounded-xl shadow-inner">
     <strong>Info</strong>     Here all instructions will be given after this software is ready, because most of our clients prefer customization. So we can only provide this once the software (LMS) is ready for your institute!
  </em>

  </div>
    </section>

<section id="section-logins" class="hidden-section">
  <!-- Notice Box -->
  <div class="bg-white border border-gray-200 text-gray-800 text-center text-sm px-6 py-4 rounded-xl shadow-sm">
    📢 All login credentials will be visible here!
  </div> 
  <br><br>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
    <!-- Student Portal Credentials -->
    <div class="bg-white rounded-2xl p-6 shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">
        🎓 Student Portal Login (DEMO_LOGINS)
      </h2>

      <div class="mb-4">
        <h3 class="font-semibold text-gray-800 mb-1">IT Department (SY)</h3>
        <p class="text-sm text-gray-600">
          Username: <span class="font-mono text-gray-900">mgmsyit</span>
        </p>
        <p class="text-sm text-gray-600">
          Password: <span class="font-mono text-gray-900">Student</span>
        </p>
      </div>

      <div>
        <h3 class="font-semibold text-gray-800 mb-1">CS Department (SY)</h3>
        <p class="text-sm text-gray-600">
          Username: <span class="font-mono text-gray-900">mgmsycs</span>
        </p>
        <p class="text-sm text-gray-600">
          Password: <span class="font-mono text-gray-900">Student</span>
        </p>
      </div>
    </div>

    <!-- Staff Credentials -->
    <div class="bg-white rounded-2xl p-6 shadow-md border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-900 mb-4">👩‍💼 Staff Login Emails</h2>
      <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
        <li><span class="font-mono text-gray-900">admin@zentech.org</span></li>
        <li><span class="font-mono text-gray-900">admin@t-service.org</span></li>
        <li><span class="font-mono text-gray-900">hr@zentech.org</span></li>
        <li><span class="font-mono text-gray-900">support@zentech.org</span></li>
      </ul>
    </div>
  </div>
</section>

<section id="section-suspension" class="hidden-section">
  <!-- Notice Box -->
  <div class="bg-white border border-gray-200 text-gray-800 text-center text-sm px-6 py-4 rounded-xl shadow-sm">
    ⚠️ Here you can suspend accounts who don't follow rules.  
    Our team might have access to this due to security reasons.  
    If staff is unable to do it, our team will handle it from our side!
  </div> 
  <br><br>
      
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- SYIT Card -->
    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col items-start space-y-4">
      <h3 class="text-xl font-semibold text-gray-900">SYIT Department</h3>
      <div class="flex gap-4">
        <button onclick="toggleSuspend('mgmsyit', this)" 
                class="suspend-btn px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition">
          Suspend
        </button>
        <a href="https://zen-tech-student-portal.vercel.app/Syit" 
           class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition">
          Visit
        </a>
      </div>
    </div>

    <!-- SYCS Card -->
    <div class="bg-white p-6 rounded-2xl shadow-md border border-gray-200 flex flex-col items-start space-y-4">
      <h3 class="text-xl font-semibold text-gray-900">SYCS Department</h3>
      <div class="flex gap-4">
        <button onclick="toggleSuspend('mgmsycs', this)" 
                class="suspend-btn px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition">
          Suspend
        </button>
        <a href="https://zen-tech-student-portal.vercel.app/Sycs" 
           class="px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition">
          Visit
        </a>
      </div>
    </div>
  </div>
</section>





    
  </main>

  <script>
    function logoutUser() {
      alert("Logging out...");
    }

    // Section switching
    const links = document.querySelectorAll(".nav-link");
    const sections = document.querySelectorAll("main section");

    links.forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        const target = link.getAttribute("data-section");

        sections.forEach(sec => sec.classList.add("hidden-section"));
        document.getElementById(`section-${target}`).classList.remove("hidden-section");

        links.forEach(l => l.classList.remove("bg-indigo-50","text-indigo-600","font-semibold"));
        link.classList.add("bg-indigo-50","text-indigo-600","font-semibold");
      });
    });
  </script>



<!-- ✅ SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- ✅ Combined Supabase Script -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  // 🔑 Supabase credentials
  const SUPABASE_URL = "https://ellxxhwuohbezfijkwvt.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsbHh4aHd1b2hiZXpmaWprd3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1MjMyNjYsImV4cCI6MjA2NDA5OTI2Nn0.cWuvYFKNV7FnD52B0n94cOFmzCFUIhxHy-sWnOLR6sI";

  // ✅ Create single global client
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.supabaseClient = supabase;

  /***********************
   * 🏆 Leaderboard Logic
   ***********************/
  const form = document.getElementById("leaderboardForm");
  const tableBody = document.getElementById("leaderboardTableBody");

  if (form && tableBody) {
    fetchLeaderboard();

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("studentName").value.trim();
      const initial = document
        .getElementById("studentInitial")
        .value.trim()
        .toUpperCase();
      const rank = parseInt(document.getElementById("studentRank").value);
      const season = parseInt(document.getElementById("seasonNumber").value);

      const { error } = await supabase
        .from("leaderboard")
        .insert([{ name, initial, rank, season }]);

      if (error) {
        Swal.fire("Error", "❌ Failed to add entry", "error");
        console.error(error);
      } else {
        Swal.fire("Success", "✅ Entry added!", "success");
        form.reset();
        fetchLeaderboard();
      }
    });
  }

  async function fetchLeaderboard() {
    const { data, error } = await supabase
      .from("leaderboard")
      .select("*")
      .order("season", { ascending: true })
      .order("rank", { ascending: true });

    if (error) {
      console.error("Fetch error:", error);
      return;
    }

    tableBody.innerHTML = "";
    data.forEach((entry) => {
      tableBody.innerHTML += `
        <tr class="bg-white dark:bg-gray-900 border-b dark:border-gray-700">
          <td class="px-4 py-2 font-semibold">${entry.season}</td>
          <td class="px-4 py-2 flex items-center gap-2">
            <span class="w-8 h-8 flex items-center justify-center rounded-full bg-violet-600 text-white font-bold">${entry.initial}</span>
            ${entry.name}
          </td>
          <td class="px-4 py-2">${getMedal(entry.rank)}</td>
        </tr>
      `;
    });
  }

  function getMedal(rank) {
    switch (rank) {
      case 1:
        return "🥇 1st";
      case 2:
        return "🥈 2nd";
      case 3:
        return "🥉 3rd";
      default:
        return "🏅";
    }
  }

  /***********************
   * 🚫 Suspend Toggle
   ***********************/
  window.toggleSuspend = async function (username, button) {
    const { data, error } = await supabase
      .from("user_roles")
      .select("is_suspended")
      .eq("username", username)
      .single();

    if (error || !data) {
      Swal.fire("Error", "User not found.", "error");
      return;
    }

    const current = data.is_suspended;
    const action = current ? "Unsuspend" : "Suspend";
    const newStatus = !current;

    Swal.fire({
      title: `Are you sure you want to ${action} this department?`,
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: action,
      cancelButtonText: "Cancel",
      confirmButtonColor: current ? "#10B981" : "#EF4444",
    }).then(async (result) => {
      if (result.isConfirmed) {
        const { error: updateError } = await supabase
          .from("user_roles")
          .update({ is_suspended: newStatus })
          .eq("username", username);

        if (updateError) {
          Swal.fire("Error", "Could not update status.", "error");
          return;
        }

        button.textContent = newStatus ? "Unsuspend" : "Suspend";
        button.classList.toggle("bg-red-500", !newStatus);
        button.classList.toggle("bg-green-500", newStatus);
        button.classList.toggle("hover:bg-red-600", !newStatus);
        button.classList.toggle("hover:bg-green-600", newStatus);

        Swal.fire(
          "Updated",
          `Department has been ${action}ed successfully.`,
          "success"
        );
      }
    });
  };

  /***********************
   * 📂 Notes Upload Logic
   ***********************/
  function initUploader(subjectId, subjectName) {
    const fileInput = document.getElementById(`${subjectId}FileInput`);
    const notesList = document.getElementById(`${subjectId}NotesList`);

    if (!fileInput || !notesList) return;

    fileInput.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file || file.type !== "application/pdf") {
        Swal.fire("Error", "Please select a valid PDF.", "error");
        return;
      }

      const fileName = `${Date.now()}_${file.name}`;
      const { error: uploadError } = await supabase.storage
        .from("notes")
        .upload(fileName, file);

      if (uploadError) {
        Swal.fire("Error", "Upload failed!", "error");
        console.error("Upload error:", uploadError.message);
        return;
      }

      const { data: urlData } = supabase.storage
        .from("notes")
        .getPublicUrl(fileName);
      const fileUrl = urlData.publicUrl;

      await supabase.from("notes").insert([
        {
          file_name: file.name,
          file_url: fileUrl,
          subject: subjectName,
          uploaded_by: "admin@zentechindia.org",
        },
      ]);

      const li = document.createElement("li");
      li.innerHTML = `
        <a href="${fileUrl}" target="_blank"
          class="block bg-gray-200 dark:bg-gray-900 px-4 py-2 rounded shadow hover:bg-violet-200 dark:hover:bg-violet-800 transition">
           ${file.name}
        </a>`;
      notesList.prepend(li);
    });

    // Load existing notes
    (async () => {
      const { data, error } = await supabase
        .from("notes")
        .select("*")
        .eq("subject", subjectName)
        .order("uploaded_at", { ascending: false });

      if (error) {
        console.error(`Error loading notes for ${subjectName}:`, error.message);
        return;
      }

      data.forEach((note) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <a href="${note.file_url}" target="_blank"
class="block bg-white border border-gray-200 px-4 py-2 rounded-md shadow-sm 
       text-gray-700 font-medium hover:bg-gray-100 transition">
             ${note.file_name}
          </a>`;
        notesList.appendChild(li);
      });
    })();
  }

  // ✅ Initialize multiple uploaders
  initUploader("python", "Python");
 
</script>
  
</body>
</html>
