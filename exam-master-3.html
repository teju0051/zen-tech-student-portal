

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Exam Master 3.0 </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800,900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-user-select: none; -ms-user-select: none; user-select: none; overflow-x: hidden; overflow-y: hidden; }
        /* Force consistent box sizing and prevent horizontal scroll */
        *, *::before, *::after { box-sizing: border-box; }
        html, body { width: 100%; }
        /* Container: centered with side gaps on wide screens, fits small screens */
        .container { max-width: 1200px; margin-left: auto; margin-right: auto; padding-left: 24px; padding-right: 24px; }
        /* Ensure media scale properly and do not create horizontal scroll */
        img, svg, video { max-width: 100%; height: auto; display: block; }
        /* Make key sections stretch to viewport height and avoid overflow */
        .min-h-screen { min-height: 100vh; }
        /* Utility to ensure main content fits vertically while keeping gaps on large screens */
        .fit-viewport { min-height: 100vh; display: flex; flex-direction: column; }
        /* Hide any accidental horizontal scrollbar on webkit browsers */
        body::-webkit-scrollbar { height: 8px; }
        body::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.08); border-radius: 9999px; }
        @media (min-width: 1400px) {
            .container { max-width: 1400px; padding-left: 48px; padding-right: 48px; }
        }
        @media (max-width: 640px) {
            .container { padding-left: 12px; padding-right: 12px; }
        }
        .glass-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(240,240,240,0.8); box-shadow: 0 10px 25px rgba(0,0,0,0.08); border-radius: .75rem; }
        .glass-header { background: rgba(255,255,255,0.95); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-bottom: 1px solid rgba(220,220,220,0.7); }
        #palette-container::-webkit-scrollbar, #review-grid-container::-webkit-scrollbar, #instructions-content::-webkit-scrollbar { width: 6px; }
        #palette-container::-webkit-scrollbar-thumb, #review-grid-container::-webkit-scrollbar-thumb, #instructions-content::-webkit-scrollbar-thumb { background: #a8a8a8; border-radius: 10px; }
        .palette-btn-active { border-color: #4f46e5 !important; border-width: 2px !important; transform: scale(1.06) !important; box-shadow: 0 0 20px rgba(79,70,229,0.12) !important; }
        .section-tab { padding: 8px 16px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: 500; color: #6b7280; transition: color .2s, border-bottom-color .2s; }
        .section-tab-active { border-bottom-color: #4f46e5; color: #4f46e5; }
        .palette-btn-answered-marked { position: relative; background-color: #3b82f6; color: white; border-color: #2563eb; border-radius: .75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.06); }

        /* Spinner overlay using your shard / lightning logo */
        .spinner-overlay { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; background: rgba(2,6,23,0.6); z-index: 9999; backdrop-filter: blur(3px); }
        .logo-spinner { width: 110px; height: 110px; object-fit: contain; filter: drop-shadow(0 8px 24px rgba(99,102,241,0.25)); animation: spin-swish 1.2s linear infinite, pulse 1.6s ease-in-out infinite; }
        .spinner-text { color: white; font-weight:700; margin-top: 12px; letter-spacing: .6px; }

        /* subtle rotate + skew animation for a dynamic shard feel */
        @keyframes spin-swish {
            0% { transform: rotate(-6deg) translateY(0) scale(1); }
            50% { transform: rotate(8deg) translateY(-6px) scale(1.02); }
            100% { transform: rotate(-6deg) translateY(0) scale(1); }
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99,102,241,0.18); }
            70% { box-shadow: 0 0 30px 12px rgba(99,102,241,0.02); }
            100% { box-shadow: 0 0 0 0 rgba(99,102,241,0); }
        }

        /* small shimmering line across the logo for polish */
        .logo-wrapper { position: relative; display:inline-block; }
        .logo-wrapper::after {
            content: '';
            position: absolute; left: -30%; top: 0; width: 60%; height: 100%; transform: skewX(-20deg) translateX(-120%);
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.55) 50%, rgba(255,255,255,0) 100%);
            opacity: 0.6; pointer-events:none; mix-blend-mode: overlay; animation: shimmer 1.6s ease-in-out infinite;
        }
        @keyframes shimmer { 0% { transform: skewX(-20deg) translateX(-120%); } 100% { transform: skewX(-20deg) translateX(220%); } }

        /* tiny accessibility improvement for hidden state */
        .hidden { display: none !important; }

      
    </style>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
  body {
    -webkit-user-select: none; /* Safari */
    -ms-user-select: none;     /* IE 10 and Edge */
    user-select: none;          /* Standard */
  }

  input, textarea {
    -webkit-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }
</style>
<script>


  document.addEventListener('contextmenu', e => e.preventDefault());

  document.addEventListener('copy', e => e.preventDefault());
  document.addEventListener('cut', e => e.preventDefault());
  document.addEventListener('paste', e => e.preventDefault());

  document.addEventListener('keydown', function(e) {
    // Block F12
    if (e.key === "F12") {
      e.preventDefault();
      return false;
    }

    if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) {
      e.preventDefault();
      return false;
    }

    if (e.ctrlKey && (e.key === 'u' || e.key === 's')) {
      e.preventDefault();
      return false;
    }
  });

  document.addEventListener('dragstart', e => e.preventDefault());
</script>
    
</head>
<body class="bg-slate-100">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
window.onload = function() {
    Swal.fire({
        width: '800px',
        padding: '0',
        background: '#ffffff',
        showConfirmButton: true,
        confirmButtonText: 'I AM READY',
        confirmButtonColor: '#1e1b4b',
        timer: 10000,
        timerProgressBar: true,
        allowOutsideClick: false,
        html: `
            <div style="display: flex; min-height: 250px; font-family: sans-serif; align-items: stretch;">
                
                <div style="flex: 1; background: #f1f5f9; display: flex; align-items: center; justify-content: center; padding: 30px; border-right: 2px solid #e2e8f0;">
                    <img src="https://teju0051.github.io/Assets/zentehc-remove-bg.png" alt="Zen-Tech" style="width: 150px;">
                </div>

                <div style="flex: 2; padding: 40px; text-align: left; display: flex; flex-direction: column; justify-content: center;">
                    <h1 style="color: #1e1b4b; font-size: 28px; font-weight: 900; margin: 0;">ZEN-TECH AI</h1>
                    <h2 style="color: #4338ca; font-size: 20px; font-weight: 700; margin-top: 5px;">EAGLE EYE AI IS ACTIVE</h2>
                    
                    <p style="color: #334155; font-size: 18px; line-height: 1.5; margin-top: 15px; font-weight: 500;">
                        Our AI is monitoring your exam right now. <br>
                        <strong>STAY ALERT STUDENTS!</strong> 
                    </p>

                    <p style="color: #ef4444; font-size: 14px; font-weight: bold; margin-top: 10px; text-transform: uppercase;">
                        Follow all rules after you login!
                    </p>

                    <div style="font-size: 12px; color: #94a3b8; margin-top: 20px;">
                        Closing in <span id="timer-count" style="font-weight: bold; color: #1e1b4b;">10</span> seconds...
                    </div>
                </div>
            </div>
        `,
        didOpen: () => {
            const b = Swal.getHtmlContainer().querySelector('#timer-count');
            setInterval(() => {
                if (b) { b.textContent = Math.ceil(Swal.getTimerLeft() / 1000); }
            }, 100);
        }
    });
};
</script>
    

    <div id="global-spinner" class="spinner-overlay hidden" aria-hidden="true">
        <div class="flex flex-col items-center justify-center">
            <div class="logo-wrapper">
                <div class="w-16 h-16 border-4 border-purple-400 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <p class="spinner-text">Loading Exam...</p>
        </div>
    </div>

    <div id="login-screen" class="flex min-h-screen items-center justify-center p-4">
        <div class="w-full max-w-5xl md:h-[600px] flex flex-col md:flex-row rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-500 hover:shadow-3xl">
            <div class="md:w-1/2 flex flex-col justify-between p-8 md:p-12 bg-white text-indigo-700 min-h-[250px] md:min-h-full">
                <div class="text-center md:pt-16">
                    <img src="https://teju0051.github.io/Assets/zentehc-remove-bg.png" alt="Zen-Tech Solutions Logo" class="h-24 mx-auto w-auto object-contain" onerror="this.onerror=null; this.src='https://placehold.co/120x96/FFFFFF/6366f1?text=ZEN';" />
                    <h1 class="text-4xl font-extrabold mt-4 tracking-tight text-indigo-800">Exam Master</h1>
                    <p class="text-indigo-500 mt-2 text-xl font-medium">C++ Multiple Choice Test</p>
                </div>
                <div class="text-center text-sm text-gray-500 mt-12 md:mt-0">
                    <p>Designed and Developed by</p>
                    <p class="font-semibold text-indigo-700">Zen-Tech Solutions</p>
                </div>
            </div>

            <div class="md:w-1/2 p-8 md:p-12 bg-indigo-50 flex flex-col justify-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome!</h2>
                <p class="text-gray-600 mb-8">Enter your name and roll number to begin.</p>
                <form id="login-form" autocomplete="off">
                    <div class="mb-5">
                        <label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">Student Name</label>
                        <input type="text" id="student-name" required class="w-full px-4 py-3 border border-indigo-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-700 shadow-sm transition" placeholder="Your Name">
                    </div>
                    <div class="mb-5 relative">
                        <label for="roll-number" class="block text-sm font-medium text-gray-700 mb-1">Roll Number</label>
                        <input id="roll-number" type="text" required class="w-full px-4 py-3 border border-indigo-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-700 shadow-sm transition" placeholder="Your Roll Number" />
                    </div>
                    <div class="mb-4 flex items-center justify-between">
                   
                    </div>

                    <div class="mb-4">
                        <strong class="text-xs text-gray-500">Note: A student cannot restart an exam once it has been initiated. A new exam attempt is permitted only once every 90 minutes (1 hour 30 minutes). Attempts to start an exam within this time limit will be denied.</strong>
                    </div>

                    <button type="submit" id="login-button" class="w-full bg-indigo-700 text-white py-3 rounded-xl font-semibold tracking-wide hover:bg-indigo-800 shadow-lg transition-all duration-300">Proceed to Instructions</button>
                    <div id="message-box" class="mt-4 p-3 bg-indigo-100 text-indigo-800 border border-indigo-200 rounded-lg hidden"></div>
                </form>
            </div>
        </div>
    </div>

    <div id="instructions-screen" class="hidden flex min-h-screen items-center justify-center p-4">
        <div class="w-full max-w-3xl p-8 bg-indigo-50 rounded-2xl shadow-2xl">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">General Instructions</h2>
            <div id="instructions-content" class="max-h-[70vh] md:max-h-96 overflow-y-auto p-6 bg-white border border-indigo-200 rounded-xl text-gray-700 space-y-4 shadow-inner">
                <p class="font-semibold text-lg text-indigo-700 border-b pb-2 mb-3">Please read carefully:</p>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>This is a timed exam. The timer will start when you click "Begin Exam".</li>
                    <li>The exam consists of <strong>30 questions</strong> divided into <strong>3 sections</strong>: Easy, Medium and Hard.</li>
                    <li>The clock in the top-right corner shows the remaining time. The exam will submit automatically when time runs out.</li>
                    <li>Navigate between questions using the palette and tabs.</li>
                    <li>Answer status is indicated by colors in the question palette (Answered, Not Answered, Marked, etc.).</li>
                    <li class="font-bold text-red-600 mt-4">This is a strictly proctored exam. Any attempt to cheat will result in immediate termination.</li>
                    <li class="font-bold text-red-600">Do NOT switch tabs, minimize the window, or use other applications.</li>
                    <li class="font-bold text-red-600">Do NOT press Print Screen, Ctrl+C, Ctrl+V, or attempt to right-click.</li>
                    <li class="font-bold text-red-600">Leaving fullscreen or exam window 3 times will automatically terminate the exam.</li>
                </ul>
                <p class="mt-4 pt-2 border-t font-semibold">Click "Begin Exam" to start. Good luck!</p>
            </div>

            <label class="flex items-center justify-center mt-6 mb-6 cursor-pointer">
                <input type="checkbox" id="agree-terms" class="h-5 w-5 text-indigo-700 focus:ring-indigo-700 border-indigo-300 rounded-lg">
                <span class="ml-2 text-gray-700 font-medium select-none">I have read and understood all the instructions.</span>
            </label>
            <button type="button" id="start-exam-btn" class="w-full bg-green-600 text-white py-3 rounded-xl font-semibold tracking-wide hover:bg-green-700 shadow-lg" disabled>Begin Exam</button>
        </div>
    </div>

    <div id="test-screen" class="hidden flex-col min-h-screen">
    <header class="w-full bg-white/90 backdrop-blur-md sticky top-0 z-40 shadow-md">
    <div class="container mx-auto flex justify-between items-center px-4 py-3">
        <div id="student-info" class="text-base font-semibold text-gray-800 flex-shrink-0">
            </div>

      <div class="flex items-center space-x-8 flex-grow justify-center">
    <div class="flex items-center space-x-2 p-2 border border-gray-300 rounded-lg bg-white shadow-sm">
        <div id="timer" class="text-xl font-extrabold text-red-700 tabular-nums">01:00:00</div>
    </div>
    
    <button id="review-submit-btn" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-semibold text-sm hover:bg-indigo-700 transition duration-150 ease-in-out shadow-lg">
        Review & Submit
    </button>
</div>

        <div class="text-sm text-gray-600 flex-shrink-0">
            Designed by <a id="zen-tech-link" class="font-bold text-indigo-700 hover:text-indigo-800 cursor-pointer">ZenTech</a>
        </div>
    </div>
</header>

        <main class="flex-1 flex flex-col md:flex-row container mx-auto p-4 gap-6">
            <div class="w-full md:w-1/3 lg:w-1/4 glass-card p-4 flex flex-col" style="max-height: 85vh;">
                <div class="flex border-b border-gray-200 mb-4" id="section-tabs"></div>
                <div id="section-status-detail" class="text-sm p-2 bg-indigo-50 border border-indigo-200 rounded-lg mb-4 hidden"></div>
                <h3 class="text-lg font-semibold mb-4 text-center">Question Palette</h3>
                <div id="palette-container" class="flex-1 overflow-y-auto">
                    <div id="question-palette" class="grid grid-cols-5 md:grid-cols-4 lg:grid-cols-5 gap-2 mb-4"></div>
                </div>
                <hr class="my-4">
                <h4 class="font-semibold mb-2">Legend:</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-green-500 mr-2 border border-gray-400"></span> Answered</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-red-500 mr-2 border border-gray-400"></span> Not Answered</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-blue-500 mr-2 border border-gray-400"></span> Marked for Review</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-gray-200 mr-2 border border-gray-400"></span> Not Visited</div>
                </div>
                <hr class="my-4">
                <div id="summary" class="text-sm space-y-1 font-medium">
                    <p>Answered: <span id="answered-count" class="font-bold">0</span></p>
                    <p>Not Answered: <span id="not-answered-count" class="font-bold">0</span></p>
                    <p>Marked: <span id="marked-count" class="font-bold">0</span></p>
                    <p>Not Visited: <span id="not-visited-count" class="font-bold">0</span></p>
                </div>
            </div>

            <div class="w-full md:w-2/3 lg:w-3/4 glass-card p-6 md:p-8">
                <h2 class="text-xl font-semibold mb-4">Question <span id="q-num">1</span></h2>
                <div class="flex flex-col gap-6 mb-6">
                    <p id="q-text" class="text-gray-800 text-lg flex-1 min-h-[100px]"></p>
                </div>

                <div id="q-options" class="space-y-4"></div>
                <hr class="my-8">
                <div class="flex flex-wrap gap-4">
                    <button id="save-next-btn" class="bg-green-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-green-700">Save & Next</button>
                    <button id="mark-review-btn" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-blue-700">Mark for Review & Next</button>
                    <button id="clear-btn" class="bg-yellow-500 text-white px-5 py-2 rounded-lg font-medium hover:bg-yellow-600">Clear Response</button>
                </div>
            </div>
        </main>

       
    </div>

    <div id="review-screen" class="hidden flex-col min-h-screen p-4">
        <h2 class="text-3xl font-bold text-center text-gray-800 my-6">Exam Review</h2>
        <div class="w-full max-w-4xl mx-auto p-8 glass-card">
            <h3 class="text-lg font-semibold mb-4 text-center">Summary</h3>
            <div id="review-summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center"></div>
            <h3 class="text-lg font-semibold mb-4 text-center">Question Status</h3>
            <div id="review-grid-container" class="max-h-64 overflow-y-auto border rounded-lg p-4">
                <div id="review-grid" class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2"></div>
            </div>
            <div class="flex flex-col md:flex-row gap-4 justify-center mt-8">
                <button id="go-back-btn" class="bg-gray-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-700">Go Back to Test</button>
                <button id="final-submit-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700">Final Submit</button>
            </div>
        </div>
    </div>

    <div id="results-screen" class="hidden flex min-h-screen items-center justify-center p-4">
        <div class="w-full max-w-2xl p-8 glass-card">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Exam Results</h2>
            <div id="result-student-info" class="text-center text-lg text-gray-700 mb-4"></div>
            <div class="bg-gray-50 p-6 rounded-lg border">
                <div class="grid grid-cols-2 gap-4 text-center mb-6">
                    <div><p class="text-sm text-gray-600">SCORE</p><p id="result-score" class="text-4xl font-bold text-green-600">-- / --</p></div>
                    <div><p class="text-sm text-gray-600">ACCURACY</p><p id="result-accuracy" class="text-4xl font-bold text-indigo-600">--%</p></div>
                </div>
                <div class="space-y-2 mb-6">
                    <p>Total Questions: <span id="summary-total" class="font-bold">--</span></p>
                    <p>Correct Answers: <span id="summary-correct" class="font-bold text-green-600">--</span></p>
                    <p>Wrong Answers: <span id="summary-wrong" class="font-bold text-red-600">--</span></p>
                    <p>Unanswered: <span id="summary-unanswered" class="font-bold text-gray-600">--</span></p>
                </div>
                <hr>
                <div class="mt-6">
                    <h3 class="font-semibold text-lg mb-2">Remarks</h3>
                    <p id="result-remarks" class="text-gray-700 italic"></p>
                </div>
            </div>
            <button id="close-results-btn" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg font-semibold hover:bg-indigo-700 mt-6">Close</button>
        </div>
    </div>


    
    <script>
        // --- C++ QUESTIONS (10 easy, 10 medium, 10 hard) ---
        const examQuestions = [ /* same array as original (omitted here for brevity in the canvas file) */
            { section: "Easy", question: "Which header file is required to use std::cout?", options: ["iostream", "stdio.h", "cout", "ostream"], correct: 0 },
            { section: "Easy", question: "Which operator is used to access members of a pointer to a structure?", options: ["->", ".", "*", "&"], correct: 0 },
            { section: "Easy", question: "What is the file extension for C++ source files?", options: [".cpp", ".c", ".java", ".py"], correct: 0 },
            { section: "Easy", question: "Which keyword is used to define a constant in C++?", options: ["const", "define", "constant", "immutable"], correct: 0 },
            { section: "Easy", question: "What does '++' operator do?", options: ["Decrements value", "Increments value", "Negates value", "Divides value"], correct: 1 },
            { section: "Easy", question: "Which of the following is correct way to start main function?", options: ["int main()", "main()", "void main", "start main()"], correct: 0 },
            { section: "Easy", question: "Which statement is used to end a loop prematurely?", options: ["break", "stop", "exit", "return 0"], correct: 0 },
            { section: "Easy", question: "Which container stores elements in key-value pairs?", options: ["map", "vector", "list", "stack"], correct: 0 },
            { section: "Easy", question: "Which operator is used for equality comparison?", options: ["=", "==", "===", ":="], correct: 1 },
            { section: "Easy", question: "Which loop will execute at least once?", options: ["for", "while", "do-while", "none"], correct: 2 },
            { section: "Medium", question: "What does STL stand for?", options: ["Standard Template Library", "Standard Type Library", "Simple Template List", "Standard Tools Library"], correct: 0 },
            { section: "Medium", question: "Which container provides random access and contiguous storage?", options: ["vector", "list", "deque", "map"], correct: 0 },
            { section: "Medium", question: "Which keyword is used to create a class in C++?", options: ["class", "struct", "object", "type"], correct: 0 },
            { section: "Medium", question: "What is function overloading?", options: ["Using same function name with different parameters", "Defining same function twice", "Changing return type only", "Using same name in different namespaces"], correct: 0 },
            { section: "Medium", question: "Which of the following is used for dynamic memory allocation?", options: ["new", "malloc", "alloc", "create"], correct: 0 },
            { section: "Medium", question: "What is a reference in C++?", options: ["An alias for another variable", "A pointer type", "A function return type", "A memory address"], correct: 0 },
            { section: "Medium", question: "Which operator is overloaded by default for user-defined types?", options: ["Assignment operator (=)", "Addition operator (+)", "Comparison operator (==)", "No operators"], correct: 0 },
            { section: "Medium", question: "Which of these is correct way to declare a template function?", options: ["template<typename T> T func(T a);", "template<T> func(T a);", "template function<T> func(T a);", "func<T>()"], correct: 0 },
            { section: "Medium", question: "What is RAII?", options: ["Resource Acquisition Is Initialization", "Random Access In Initialization", "Resource Allocation Is Immediate", "Runtime Acquisition Is Initialization"], correct: 0 },
            { section: "Medium", question: "Which C++11 feature allows range-based loops?", options: ["auto", "nullptr", "range-for", "lambda"], correct: 2 },
            { section: "Hard", question: "What does 'constexpr' specify?", options: ["A compile-time constant expression", "A runtime variable", "A deprecated feature", "A constant pointer"], correct: 0 },
            { section: "Hard", question: "Which smart pointer deletes the owned object when it goes out of scope and cannot be copied?", options: ["std::unique_ptr", "std::shared_ptr", "std::weak_ptr", "std::auto_ptr"], correct: 0 },
            { section: "Hard", question: "What is the complexity of accessing an element by index in std::vector?", options: ["O(1)", "O(log n)", "O(n)", "O(n log n)"], correct: 0 },
            { section: "Hard", question: "Which feature avoids slicing when copying polymorphic objects?", options: ["Virtual clone (deep copy via virtual function)", "Copy constructor", "Assignment operator", "Default copy"], correct: 0 },
            { section: "Hard", question: "What does 'move semantics' primarily enable?", options: ["Efficient transfer of resources", "Automatic garbage collection", "Reference counting", "Compile-time reflection"], correct: 0 },
            { section: "Hard", question: "Which header provides std::thread?", options: ["thread", "pthread.h", "threads", "concurrency"], correct: 0 },
            { section: "Hard", question: "Which cast should be used to convert void* to typed pointer safely in C++?", options: ["static_cast", "reinterpret_cast", "const_cast", "dynamic_cast"], correct: 0 },
            { section: "Hard", question: "What is SFINAE used for?", options: ["Substitution Failure Is Not An Error (template overloading selection)", "Binary search optimization", "Memory allocation strategy", "Exception handling"], correct: 0 },
            { section: "Hard", question: "Which C++ standard introduced move semantics and rvalue references?", options: ["C++11", "C++98", "C++14", "C++17"], correct: 0 },
            { section: "Hard", question: "Which of the following ensures thread-safe lazy initialization in C++11 local statics?", options: ["Guaranteed initialization (thread-safe) of function local static variables", "Manual locks", "volatile keyword", "std::atomic_flag only"], correct: 0 }
        ];

        // --- State ---
        const examSections = [...new Set(examQuestions.map(q => q.section))];
        let studentName = "";
        let rollNumber = "";
        let currentQuestionIndex = 0;
        let currentSection = examSections[0];
        let timeLeft = 3600; // seconds
        let timerInterval = null;
        let cheatAttempts = 0;
        let examTerminated = false;
        let questionStates = [];

        // DOM
        const loginScreen = document.getElementById('login-screen');
        const instructionsScreen = document.getElementById('instructions-screen');
        const testScreen = document.getElementById('test-screen');
        const reviewScreen = document.getElementById('review-screen');
        const resultsScreen = document.getElementById('results-screen');
        const globalSpinner = document.getElementById('global-spinner');

        const loginForm = document.getElementById('login-form');
        const studentNameInput = document.getElementById('student-name');
        const rollNumberInput = document.getElementById('roll-number'); // NEW: Roll Number Input

        const agreeTerms = document.getElementById('agree-terms');
        const startExamBtn = document.getElementById('start-exam-btn');

        const studentInfo = document.getElementById('student-info');
        const timerElement = document.getElementById('timer');

        const sectionTabsContainer = document.getElementById('section-tabs');
        const sectionStatusDetail = document.getElementById('section-status-detail');
        const questionPalette = document.getElementById('question-palette');
        const qNum = document.getElementById('q-num');
        const qText = document.getElementById('q-text');
        const qOptions = document.getElementById('q-options');

        const saveNextBtn = document.getElementById('save-next-btn');
        const markReviewBtn = document.getElementById('mark-review-btn');
        const clearBtn = document.getElementById('clear-btn');
        const zenTechLink = document.getElementById('zen-tech-link');
        const reviewSubmitBtn = document.getElementById('review-submit-btn');

        const reviewSummary = document.getElementById('review-summary');
        const reviewGrid = document.getElementById('review-grid');
        const goBackBtn = document.getElementById('go-back-btn');
        const finalSubmitBtn = document.getElementById('final-submit-btn');

        const closeResultsBtn = document.getElementById('close-results-btn');

        // --- Helpers: spinner ---
        function showSpinnerFor(ms) {
            return new Promise(resolve => {
                globalSpinner.classList.remove('hidden');
                globalSpinner.setAttribute('aria-hidden', 'false');
                setTimeout(() => {
                    globalSpinner.classList.add('hidden');
                    globalSpinner.setAttribute('aria-hidden', 'true');
                    resolve();
                }, ms);
            });
        }

        // --- Init ---
        function initExam() {
            questionStates = examQuestions.map((q, index) => ({ status: 'not-visited', answer: null, section: q.section }));
            const firstQuestionOfSection = examQuestions.findIndex(q => q.section === currentSection);
            if (firstQuestionOfSection !== -1) {
                questionStates[firstQuestionOfSection].status = 'not-answered';
                currentQuestionIndex = firstQuestionOfSection;
            } else {
                questionStates[0].status = 'not-answered';
                currentQuestionIndex = 0;
            }
            populateSectionTabs();
            populatePalette();
            // loadQuestion now WITHOUT spinner — spinner is reserved for login/initial loads only
            loadQuestion(currentQuestionIndex);
            startTimer();
            updateSummary();
            updateSectionStatus();
            initAntiCheat();
        }

        function populateSectionTabs() {
            sectionTabsContainer.innerHTML = "";
            examSections.forEach(section => {
                const tab = document.createElement('div');
                tab.innerText = section;
                tab.className = `section-tab ${section === currentSection ? 'section-tab-active' : ''}`;
                tab.dataset.section = section;
                tab.addEventListener('click', () => switchSection(section));
                sectionTabsContainer.appendChild(tab);
            });
        }

        function switchSection(sectionName) {
            currentSection = sectionName;
            populateSectionTabs();
            populatePalette();
            let firstQuestionIndex = -1;
            for (let i = 0; i < examQuestions.length; i++) {
                if (examQuestions[i].section === sectionName) {
                    if (firstQuestionIndex === -1) firstQuestionIndex = i;
                    if (questionStates[i].status === 'not-visited' || questionStates[i].status === 'not-answered') { firstQuestionIndex = i; break; }
                }
            }
            if (firstQuestionIndex !== -1) loadQuestion(firstQuestionIndex);
            updateSectionStatus();
        }

        function populatePalette() {
            questionPalette.innerHTML = "";
            examQuestions.forEach((q, index) => {
                if (q.section !== currentSection) return;
                const btn = document.createElement('button');
                btn.innerText = `Q.${index + 1}`;
                btn.dataset.index = index;
                btn.className = `palette-btn w-12 h-12 rounded-lg font-medium border transition-all duration-200 ${getPaletteColor(questionStates[index].status)}`;
                if (index === currentQuestionIndex) btn.classList.add('palette-btn-active');
                btn.addEventListener('click', () => handlePaletteClick(index));
                questionPalette.appendChild(btn);
            });
        }

        function getPaletteColor(status) {
            switch (status) {
                case 'answered': return 'bg-green-500 text-white border-green-600 shadow-md rounded-xl';
                case 'not-answered': return 'bg-red-500 text-white border-red-600 shadow-md rounded-xl';
                case 'answered-marked': return 'palette-btn-answered-marked';
                case 'marked': return 'bg-blue-500 text-white border-blue-600 shadow-md rounded-xl';
                case 'not-visited':
                default: return 'bg-gray-200/70 text-gray-800 border-gray-300 rounded-xl';
            }
        }

        async function loadQuestion(index) {
            if (index < 0 || index >= examQuestions.length) return;
            saveAnswer();
            // NOTE: Spinner intentionally NOT shown here — spinner is reserved for login/initial loading flow.
            currentQuestionIndex = index;
            const question = examQuestions[index];
            const state = questionStates[index];
            if (state.status === 'not-visited') state.status = 'not-answered';
            if (question.section !== currentSection) {
                currentSection = question.section;
                populateSectionTabs();
                populatePalette();
            }
            qNum.innerText = index + 1;
            qText.innerText = question.question;
            qOptions.innerHTML = "";
            question.options.forEach((option, i) => {
                qOptions.innerHTML += `
                    <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition bg-white/30 border-gray-200/50">
                        <input type="radio" name="option" value="${i}" class="mr-3 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                        <span class="text-gray-700">${option}</span>
                    </label>
                `;
            });
            const savedAnswer = state.answer;
            if (savedAnswer !== null) {
                const el = document.querySelector(`input[name="option"][value="${savedAnswer}"]`);
                if (el) el.checked = true;
            }
            updatePalette();
            updateSummary();
            updateSectionStatus();
        }

        function saveAnswer() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= examQuestions.length) return;
            const selectedOption = document.querySelector('input[name="option"]:checked');
            const state = questionStates[currentQuestionIndex];
            if (selectedOption) {
                state.answer = parseInt(selectedOption.value);
                if (state.status !== 'marked' && state.status !== 'answered-marked') state.status = 'answered';
            } else {
                if (state.status === 'answered') { state.status = 'not-answered'; state.answer = null; }
            }
        }

        function updatePalette() {
            const buttons = document.querySelectorAll('.palette-btn');
            buttons.forEach(btn => {
                const index = parseInt(btn.dataset.index);
                if (isNaN(index)) return;
                btn.className = `palette-btn w-12 h-12 rounded-lg font-medium border transition-all duration-200 ${getPaletteColor(questionStates[index].status)}`;
                if (index === currentQuestionIndex) btn.classList.add('palette-btn-active');
            });
            updateSectionStatus();
        }

        function getSummaryCounts() {
            let answered=0, notAnswered=0, marked=0, answeredMarked=0, notVisited=0;
            questionStates.forEach(state => {
                switch(state.status) {
                    case 'answered': answered++; break;
                    case 'not-answered': notAnswered++; break;
                    case 'marked': marked++; break;
                    case 'answered-marked': answeredMarked++; break;
                    case 'not-visited': notVisited++; break;
                }
            });
            return { answered, notAnswered, marked, answeredMarked, notVisited };
        }

        function updateSummary() {
            const counts = getSummaryCounts();
            document.getElementById('answered-count').innerText = counts.answered + counts.answeredMarked;
            document.getElementById('not-answered-count').innerText = counts.notAnswered;
            document.getElementById('marked-count').innerText = counts.marked + counts.answeredMarked;
            document.getElementById('not-visited-count').innerText = counts.notVisited;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (examTerminated) { clearInterval(timerInterval); return; }
                timeLeft--;
                const minutes = Math.floor(timeLeft/60);
                const seconds = timeLeft % 60;
                // Updated Timer UI text for better visibility
                timerElement.innerText = `Time Left: ${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    Swal.fire({ icon:'warning', title:"Time's Up!", text:'Your exam will be submitted automatically.', showConfirmButton:false, timer:3000 });
                    setTimeout(() => submitExam(false), 3000);
                }
            }, 1000);
        }

        function showReviewScreen() {
            saveAnswer();
            testScreen.classList.add('hidden');
            reviewScreen.classList.remove('hidden');
            reviewScreen.classList.add('flex');
            const counts = getSummaryCounts();
            reviewSummary.innerHTML = `
                <div class="p-4 bg-green-100 rounded-lg"><p class="text-sm text-green-700">Answered</p><p class="text-2xl font-bold text-green-800">${counts.answered + counts.answeredMarked}</p></div>
                <div class="p-4 bg-red-100 rounded-lg"><p class="text-sm text-red-700">Not Answered</p><p class="text-2xl font-bold text-red-800">${counts.notAnswered}</p></div>
                <div class="p-4 bg-blue-100 rounded-lg"><p class="text-sm text-blue-700">Marked</p><p class="text-2xl font-bold text-blue-800">${counts.marked + counts.answeredMarked}</p></div>
                <div class="p-4 bg-gray-100 rounded-lg"><p class="text-sm text-gray-700">Not Visited</p><p class="text-2xl font-bold text-gray-800">${counts.notVisited}</p></div>
            `;
            reviewGrid.innerHTML = "";
            examQuestions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.innerText = index + 1;
                btn.dataset.index = index;
                btn.className = `w-12 h-12 rounded-lg font-medium border transition-all duration-200 ${getPaletteColor(questionStates[index].status)}`;
                btn.addEventListener('click', () => { reviewScreen.classList.add('hidden'); testScreen.classList.remove('hidden'); testScreen.classList.add('flex'); loadQuestion(index); });
                reviewGrid.appendChild(btn);
            });
        }

        function submitExam(isCheating) {
            examTerminated = true;
            clearInterval(timerInterval);
            exitFullscreen();
            testScreen.classList.add('hidden');
            reviewScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            resultsScreen.classList.add('flex');
            // Updated student info display on results screen
            document.getElementById('result-student-info').innerText = `Name: ${studentName} | Roll Number: ${rollNumber}`;
            if (isCheating) {
                document.getElementById('result-score').innerText = "N/A";
                document.getElementById('result-accuracy').innerText = "N/A";
                document.getElementById('summary-total').innerText = examQuestions.length;
                document.getElementById('summary-correct').innerText = "N/A";
                document.getElementById('summary-wrong').innerText = "N/A";
                document.getElementById('summary-unanswered').innerText = "N/A";
                document.getElementById('result-remarks').innerText = "Exam terminated due to cheating. No score will be recorded.";
                return;
            }
            let correctAnswers=0, wrongAnswers=0, unanswered=0, totalAnswered=0;
            questionStates.forEach((state, index) => {
                if (state.status === 'not-visited' || state.status === 'not-answered' || state.status === 'marked') {
                    unanswered++;
                } else if (state.status === 'answered' || state.status === 'answered-marked') {
                    totalAnswered++;
                    if (state.answer === examQuestions[index].correct) correctAnswers++; else wrongAnswers++;
                }
            });
            const totalAttempted = correctAnswers + wrongAnswers;
            const accuracy = totalAttempted === 0 ? 0 : ((correctAnswers/totalAttempted)*100).toFixed(2);
            document.getElementById('result-score').innerText = `${correctAnswers} / ${examQuestions.length}`;
            document.getElementById('result-accuracy').innerText = `${accuracy}%`;
            document.getElementById('summary-total').innerText = examQuestions.length;
            document.getElementById('summary-correct').innerText = correctAnswers;
            document.getElementById('summary-wrong').innerText = wrongAnswers;
            document.getElementById('summary-unanswered').innerText = unanswered;
            let remarks = "";
            const percentage = (correctAnswers / examQuestions.length) * 100;
            if (percentage >= 90) remarks = "Excellent performance!"; else if (percentage >= 75) remarks = "Good job!"; else if (percentage >= 50) remarks = "Fair result."; else remarks = "You need to review the material more thoroughly.";
            document.getElementById('result-remarks').innerText = remarks;
        }

     // Event handlers
loginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const username = studentNameInput.value.trim();
    const roll = rollNumberInput.value.trim(); // Get roll number
    if (!username || !roll) {
        Swal.fire({ icon:'error', title:'Missing fields', text:'Please enter both username and roll number.' });
        return;
    }

    // --- Block Check Logic (Updated) ---
    const now = Date.now();
    const ninetyMinutes = 90 * 60 * 1000;
    
    // Define the two keys to check and set
    const userKey = `lastLogin_user_${username.toLowerCase()}`;
    const rollKey = `lastLogin_roll_${roll.toLowerCase()}`;
    
    // Function to check if a key is blocked
    const checkBlock = (key, type) => {
        const last = localStorage.getItem(key);
        if (last) {
            const lastTs = parseInt(last, 10);
            if (!isNaN(lastTs) && (now - lastTs) < ninetyMinutes) {
                const minsLeft = Math.ceil((ninetyMinutes - (now - lastTs)) / 60000);
                Swal.fire({ 
                    icon:'warning', 
                    title:'Login blocked', 
                    html: `This ${type} was recently used for an exam. Please wait <b>${minsLeft} minute(s)</b> before trying again.` 
                });
                return true; // Blocked
            }
        }
        return false; // Not blocked
    };

    // Check if Username is blocked
    if (checkBlock(userKey, 'username')) {
        return;
    }

    // Check if Roll Number is blocked
    if (checkBlock(rollKey, 'roll number')) {
        return;
    }
    // --- End Block Check Logic ---

    // Save last login timestamp for both keys (client-side). 
    // This blocks both the specific username AND the specific roll number.
    localStorage.setItem(userKey, String(now));
    localStorage.setItem(rollKey, String(now));

    // Minimal "loading" on initial login — show the custom lightning spinner here only
    showSpinnerFor(1200).then(() => {
        studentName = username;
        rollNumber = roll; // Store roll number
        // NEW: Updated student info display on test screen
        studentInfo.innerText = `Student: ${studentName} | Roll No: ${rollNumber}`; 
        loginScreen.classList.add('hidden');
        instructionsScreen.classList.remove('hidden');
        instructionsScreen.classList.add('flex');
    });
});

// The old toggle-password button is now removed as the password field is gone.

agreeTerms.addEventListener('change', () => startExamBtn.disabled = !agreeTerms.checked);

startExamBtn.addEventListener('click', () => {
    instructionsScreen.classList.add('hidden');
    testScreen.classList.remove('hidden');
    testScreen.classList.add('flex');
    requestFullscreen();
    initExam();
});

        function handlePaletteClick(index) { loadQuestion(index); }

        saveNextBtn.addEventListener('click', () => {
            saveAnswer();
            let nextIndex = -1;
            for (let i = currentQuestionIndex + 1; i < examQuestions.length; i++) {
                if (examQuestions[i].section === currentSection) { nextIndex = i; break; }
            }
            if (nextIndex !== -1) { loadQuestion(nextIndex); } else {
                const currentSectionIndex = examSections.indexOf(currentSection);
                const nextSection = examSections[currentSectionIndex + 1];
                if (nextSection) switchSection(nextSection);
                else { loadQuestion(0); Swal.fire({ icon:'info', title:'You are at the last question', text:'Cycling back to the first question.', toast:true, position:'top-end', showConfirmButton:false, timer:2000 }); }
            }
            updateSectionStatus();
        });

        markReviewBtn.addEventListener('click', () => {
            saveAnswer();
            const state = questionStates[currentQuestionIndex];
            if (state.answer !== null) state.status = 'answered-marked'; else state.status = 'marked';
            let nextIndex = -1;
            for (let i = currentQuestionIndex + 1; i < examQuestions.length; i++) {
                if (examQuestions[i].section === currentSection) { nextIndex = i; break; }
            }
            if (nextIndex !== -1) loadQuestion(nextIndex); else {
                const currentSectionIndex = examSections.indexOf(currentSection);
                const nextSection = examSections[currentSectionIndex + 1];
                if (nextSection) switchSection(nextSection); else loadQuestion(0);
            }
            updateSectionStatus();
        });

        clearBtn.addEventListener('click', () => {
            const selectedOption = document.querySelector('input[name="option"]:checked');
            if (selectedOption) selectedOption.checked = false;
            questionStates[currentQuestionIndex].answer = null;
            questionStates[currentQuestionIndex].status = 'not-answered';
            updatePalette(); updateSummary(); updateSectionStatus();
        });

        zenTechLink.addEventListener('click', () => {
            Swal.fire({
                title: 'External Link Warning',
                text: "This is an external link. Clicking 'OK' will immediately terminate your exam. Are you sure you want to proceed?",
                icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', cancelButtonColor: '#3085d6', confirmButtonText: 'OK, End Exam', cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    examTerminated = true; clearInterval(timerInterval);
                    Swal.fire({ title: 'Exam Terminated', text: 'Your exam has been terminated due to redirection.', icon: 'error', timer: 3000, showConfirmButton:false }).then(() => submitExam(true));
                }
            });
        });

        reviewSubmitBtn.addEventListener('click', () => showReviewScreen());
        goBackBtn.addEventListener('click', () => { reviewScreen.classList.add('hidden'); testScreen.classList.remove('hidden'); testScreen.classList.add('flex'); });
        finalSubmitBtn.addEventListener('click', () => {
            Swal.fire({ title:'Final Submit?', text:"Are you sure you want to end the exam? You cannot make any more changes.", icon:'question', showCancelButton:true, confirmButtonColor:'#3085d6', cancelButtonColor:'#d33', confirmButtonText:'Yes, submit!' })
            .then((result) => { if (result.isConfirmed) submitExam(false); });
        });

        closeResultsBtn.addEventListener('click', () => window.location.reload());

       // --- Fullscreen API Helpers ---
        function requestFullscreen() {
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            else if (document.documentElement.mozRequestFullScreen) document.documentElement.mozRequestFullScreen();
            else if (document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
            else if (document.documentElement.msRequestFullscreen) document.documentElement.msRequestFullscreen();
        }
        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            else if (document.documentElement.msExitFullscreen) document.documentElement.msExitFullscreen();
        }

    // New function for immediate termination (for source code access attempts)
        function terminateExamImmediately(reason) {
            if (examTerminated) return;
            examTerminated = true;
            clearInterval(timerInterval);
            exitFullscreen();
            
            // Log the severe violation (SERVER REPORTING PLACEHOLDER)
            console.error(`[CRITICAL CHEAT DETECTED] Student: ${studentName} | Reason: ${reason}`);

            // Immediately show a severe, non-dismissible warning before submitting the result
            Swal.fire({ 
                icon: 'error', 
                title: 'EXAM TERMINATED IMMEDIATELY', 
                html: `<p>A critical security violation was detected: <b>${reason}</b>. </p><p>Your exam has been terminated without warning. No score will be recorded.</p>`, 
                showConfirmButton: false, 
                allowOutsideClick: false, 
                timer: 4000 // Display for 4 seconds
            }).then(() => {
                submitExam(true); // submit with cheating flag set
            });
        }

        // --- Developer Tools Detection ---
        function checkDevTools() {
            if (examTerminated) return;
            // Check for large discrepancies between inner and outer window size, common when DevTools is open.
            // This is the most reliable client-side check.
            const threshold = 160; 
            const isDevToolsOpen = 
                window.outerWidth - window.innerWidth > threshold ||
                window.outerHeight - window.innerHeight > threshold;

            if (isDevToolsOpen) {
                // Critical violation detected: Terminate immediately
                terminateExamImmediately('Developer Tools Detected (Window Size Check)');
                return;
            }
            // Repeat check every 500ms
            setTimeout(checkDevTools, 500); 
        }

        let lastCheatTime = 0;
        function handleCheatAttempt(reason) {
            if (examTerminated) return;
            if (Swal.isVisible()) return;
            const now = Date.now();
            // Throttle attempts to prevent spamming from rapid events (e.g., multiple keypresses)
            if (now - lastCheatTime < 1000) return;
            lastCheatTime = now;
            
            // --- SERVER REPORTING PLACEHOLDER (CRITICAL) ---
            console.warn(`[CHEAT DETECTED] Student: ${studentName} | Reason: ${reason} | Attempt: ${cheatAttempts + 1}`);
            // (Keep server reporting logic here)
            // -----------------------------------------------------

            cheatAttempts++;
            if (cheatAttempts >= 3) {
                Swal.fire({ icon:'error', title:'Cheating Detected!', text:'You have left the exam window multiple times. Your exam has been terminated.', showConfirmButton:false, allowOutsideClick:false, timer:4000 });
                setTimeout(() => submitExam(true), 4000); // Submits exam with cheating flag
            } else {
                Swal.fire({ icon:'warning', title:'Warning!', text:`Do not leave the exam window. This is attempt ${cheatAttempts} of 3.`, timer:3000, timerProgressBar:true });
                requestFullscreen();
            }
        }

        function initAntiCheat() {
            // 1. 3-Warning Cheats (Visibility, Fullscreen Exit, Window Blur, Right-Click)
            document.addEventListener('visibilitychange', () => { if (document.hidden) handleCheatAttempt('Tab switch'); });
            // This handles F11 Exit, tied to the 3-warning system.
            document.addEventListener('fullscreenchange', () => { if (!document.fullscreenElement) handleCheatAttempt('Fullscreen exit (e.g. F11 press)'); });
            window.addEventListener('blur', () => handleCheatAttempt('Window blur (e.g. Alt+Tab, click outside)'));
            document.addEventListener('contextmenu', (e) => e.preventDefault()); // Disables right-click menu
            
            // Prevent text selection (copying text)
            document.addEventListener('selectstart', (e) => {
                e.preventDefault();
                return false;
            });
            
            // Start the periodic DevTools window size check
            checkDevTools();
            
            // 2. Immediate Termination Cheats (Source Code Access & Critical Shortcuts)
            document.addEventListener('keydown', (e) => {
                if (examTerminated) return;
                
                // --- Critical Security Violations (Immediate Termination) ---
                
                // ESCAPE KEY (Exit fullscreen, often used to bypass F11 detection) - keyCode 27
                if (e.keyCode === 27) {
                    e.preventDefault();
                    terminateExamImmediately('Escape Key Pressed (Attempt to Exit Fullscreen)');
                    return;
                }
                
                // F12 key (Developer Tools) - keyCode 123
                if (e.keyCode === 123) {
                    e.preventDefault();
                    terminateExamImmediately('F12 (Developer Tools Key)');
                    return;
                }
                
                // Ctrl+Shift+I (Inspect Element) - keyCode 73
                // Ctrl+Shift+J (Console) - keyCode 74
                // Ctrl+Shift+C (Inspect) - keyCode 67
                if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) {
                    e.preventDefault();
                    let key = (e.keyCode === 73) ? 'I' : (e.keyCode === 74) ? 'J' : 'C';
                    terminateExamImmediately(`Ctrl+Shift+${key} (Developer Tools Shortcut)`);
                    return;
                }
                
                // Ctrl+U (View Source) - keyCode 85
                if (e.ctrlKey && e.keyCode === 85) {
                    e.preventDefault();
                    terminateExamImmediately('Ctrl+U (View Source)');
                    return;
                }

                // --- Less Critical Cheats (Prevent action & trigger 3-warning system) ---

                // Prevent common copy (C), paste (V), cut (X), select all (A), print (P) hotkeys
                if ((e.ctrlKey || e.metaKey) && ['c', 'v', 'x', 'a', 'p'].includes(e.key.toLowerCase())) {
                    e.preventDefault(); 
                    handleCheatAttempt(`Disallowed Hotkey: ${e.key}`);
                }

                // Prevent Print Screen key (PrtScn)
                if (e.key === 'PrintScreen' || e.key === 'Snapshot' || e.keyCode === 44) {
                    e.preventDefault();
                    handleCheatAttempt('Print Screen Attempt');
                }
            }, false);
        }

        // Section status
        function updateSectionStatus() {
            const sectionCounts = {};
            questionStates.forEach((state, index) => {
                const section = examQuestions[index].section;
                if (!sectionCounts[section]) sectionCounts[section] = { answered:0, notAnswered:0, marked:0 };
                const status = state.status;
                if (status === 'answered' || status === 'answered-marked') sectionCounts[section].answered++;
                else if (status === 'not-answered' || status === 'not-visited') sectionCounts[section].notAnswered++;
                if (status === 'marked' || status === 'answered-marked') sectionCounts[section].marked++;
            });
            if (sectionCounts[currentSection]) {
                const counts = sectionCounts[currentSection];
                const total = examQuestions.filter(q => q.section === currentSection).length;
                sectionStatusDetail.classList.remove('hidden');
                sectionStatusDetail.innerHTML = `
                    <p class="font-medium text-indigo-800">${currentSection} Status:</p>
                    <div class="flex justify-between text-xs mt-1 font-semibold">
                        <span class="text-green-600">Ans: <b>${counts.answered}</b></span>
                        <span class="text-red-600">Not Ans: <b>${total - counts.answered}</b></span>
                        <span class="text-blue-600">Marked: <b>${counts.marked}</b></span>
                        <span class="text-gray-600">Total: <b>${total}</b></span>
                    </div>
                `;
            } else sectionStatusDetail.classList.add('hidden');
        }

        // Helpers
        function performSubmitFromTimeout() { submitExam(false); }

        // Show initial loader on full page load for a short moment for polish
        document.addEventListener('DOMContentLoaded', async () => {
            // show spinner briefly then reveal login screen (helps mask asset loads)
            await showSpinnerFor(900);
            // ensure login screen visible (it already is)
        });

        // Start (no auto-init; waits for user)
    </script>
</body>
</html>
